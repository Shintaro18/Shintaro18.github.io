<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="ja">

<!--2026/02/10 17:56:25-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=Shift_JIS">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <meta http-equiv="Content-Script-Type" content="text/javascript">
  <meta name="GENERATOR" content="ホームページV4">
  <title>6. About &quot;Phase2&quot; - Kitaya lab</title>
  <link rel="stylesheet" href="02_white_a0_0010.css" type="text/css" media="all">
</head>

<body>
  <div id="page">
  <div id="header">operanthouseのヘッダー</div>
  <div id="title">
  <h1>Kitaya lab</h1></div>
  <div id="menubar"><div class="mainmenu"><ul><li class="mainmenulistitem"><span class="mainmenuitem"><span class="mainmenuitemright"><span class="mainmenuitemcenter"><a href="index.html" class="mainmenuitemlink"><span class="mainmenuitemmark">オペラントハウスとは</span></a></span></span></span></li><li class="mainmenulistitem"><span class="mainmenuitem"><span class="mainmenuitemright"><span class="mainmenuitemcenter"><a href="office1001038.html" class="mainmenuitemlink"><span class="mainmenuitemmark">What's Operant House?</span></a></span></span></span></li><li class="mainmenulistitem"><span class="mainmenuitem"><span class="mainmenuitemright"><span class="mainmenuitemcenter"><a href="profile1.html" class="mainmenuitemlink"><span class="mainmenuitemmark">行動解析君とは?</span></a></span></span></span></li><li class="mainmenulistitem"><span class="mainmenuitem"><span class="mainmenuitemright"><span class="mainmenuitemcenter"><a href="profile1076.html" class="mainmenuitemlink"><span class="mainmenuitemmark">Mr. Behavio?</span></a></span></span></span></li><li class="mainmenulistitem"><span class="mainmenuitem"><span class="mainmenuitemright"><span class="mainmenuitemcenter"><a href="profile1001.html" class="mainmenuitemlink"><span class="mainmenuitemmark">Gait analyzer</span></a></span></span></span></li><li class="mainmenulistitem"><span class="mainmenuitem"><span class="mainmenuitemright"><span class="mainmenuitemcenter"><a href="privacy1.html" class="mainmenuitemlink"><span class="mainmenuitemmark">プライバシーポリシー</span></a></span></span></span></li></ul>

</div></div>
  <div id="side1">
  <div class="submenu"><ul><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001038.html" class="submenuitemlink"><span class="submenuitemmark1">What's Operant House?</span></a></span></span></span></li><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001039.html" class="submenuitemlink"><span class="submenuitemmark1">Preparation(Download)</span></a></span></span></span></li><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="99_blank004.html" class="submenuitemlink"><span class="submenuitemmark1">Production of the OperantHouse</span></a></span></span></span></li><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="99_blank005.html" class="submenuitemlink"><span class="submenuitemmark1">About Option Parts</span></a></span></span></span></li><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001055.html" class="submenuitemlink"><span class="submenuitemmark1">Handling of OperantHouse</span></a></span></span></span></li><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="99_blank006.html" class="submenuitemlink"><span class="submenuitemmark1">Custom task</span></a></span></span></span></li><li><span class="submenuitem" style="margin-left:10px;"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001056.html" class="submenuitemlink"><span class="submenuitemmark2">1. Preparation</span></a></span></span></span></li><li><span class="submenuitem" style="margin-left:10px;"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001057.html" class="submenuitemlink"><span class="submenuitemmark2">2. Overview of the code</span></a></span></span></span></li><li><span class="submenuitem" style="margin-left:10px;"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001058.html" class="submenuitemlink"><span class="submenuitemmark2">3. About &quot;Phase 0&quot;</span></a></span></span></span></li><li><span class="submenuitem" style="margin-left:10px;"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001059.html" class="submenuitemlink"><span class="submenuitemmark2">4. About &quot;Save&quot;</span></a></span></span></span></li><li><span class="submenuitem" style="margin-left:10px;"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001060.html" class="submenuitemlink"><span class="submenuitemmark2">5. About &quot;Phase 1&quot;</span></a></span></span></span></li><li><span class="submenuitem" style="margin-left:10px;"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001061.html" class="submenuitemlink"><span class="submenuitemmark2">6. About &quot;Phase2&quot;</span></a></span></span></span></li><li><span class="submenuitem" style="margin-left:10px;"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001062.html" class="submenuitemlink"><span class="submenuitemmark2">7. Modifying Code part1</span></a></span></span></span></li><li><span class="submenuitem" style="margin-left:10px;"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001048.html" class="submenuitemlink"><span class="submenuitemmark2">8. Modifying Code part2</span></a></span></span></span></li><li><span class="submenuitem" style="margin-left:10px;"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001065.html" class="submenuitemlink"><span class="submenuitemmark2">9. Modifying Code for Lever</span></a></span></span></span></li><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001072.html" class="submenuitemlink"><span class="submenuitemmark1">Command list</span></a></span></span></span></li><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001073.html" class="submenuitemlink"><span class="submenuitemmark1">Default tasks</span></a></span></span></span></li><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001063.html" class="submenuitemlink"><span class="submenuitemmark1">Tips</span></a></span></span></span></li><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001064.html" class="submenuitemlink"><span class="submenuitemmark1">Troubleshooting</span></a></span></span></span></li><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001102.html" class="submenuitemlink"><span class="submenuitemmark1">Copyright</span></a></span></span></span></li><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001071.html" class="submenuitemlink"><span class="submenuitemmark1">日本語ページへ</span></a></span></span></span></li></ul>
</div></div>
  <div id="side2"></div>
  <div class="HPZAutoMarginAdjuster" id="main_wrapper000">
  <div id="main">
  <h1>6. About &quot;Phase2&quot;</h1>
  <br clear="all">
  <br clear="all">
  Code in phase 2 is executed during the task. Phase 2 is also started with initialization.<br clear="all">
  <font color="Blue">=================================================================================================================</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if Phase2_Init == 0: # Initialization of the task</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PutEndTaskNowButton() &nbsp; # Put &quot;TaskEnd&quot; button on Main window</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mStatusVar.set('Test task (' + str(GetTaskID()) + ') &nbsp; &nbsp;Start time ' + str(TaskStartedMonth) + '/' + str(TaskStartedDay) + ' ' + str(TaskStartedHour) + ':' + str(TaskStartedMinute) + ' &nbsp; &nbsp;Running') &nbsp; &nbsp;# Substitute latest information about current task into &quot;mStatusVar&quot;</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mOngoingResult = ttk.Label(MainWindowRightFrame, textvariable=mOngoingResultVar)</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mOngoingResult.place(x=10, y=18)</font><br clear="all">
  <br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Assign task parameter values in StringVars into integer or string variable (to make the cord easeir to read)</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;MaxCorrectNum=int(MaxCorrectNumVar.get()) &nbsp; # Get the value of &quot;MaxCorrectNumVar&quot; and convert it from string to integerand assign into variable named &quot;MaxCorrectNum&quot;</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TimeLimit = int(TimeLimitVar.get())</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LickDur = int(LickDurVar.get())</font><br clear="all">
  <br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Declar local variables for this task</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CorrectNum = 0</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TaskDur = 0 &nbsp;# This will keep the elapsed time during of task</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NowDrinking = 0</font><br clear="all">
  <br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;StartRecording() &nbsp;# Start camera capture / TTL signal output</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;StartLickRecording() &nbsp;# Start an entry of lick log</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LightCycleControlOff() &nbsp;# Deactivate automatic Light/Dark cycle illumination</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;RoofLightOff() &nbsp;# Turn off the lights on roof (Digital output Ch13)</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;InfraredLightOn() &nbsp; # Turn on the infrared LED illumination (Digital output Ch12)</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DigitalOutOn(10) &nbsp; &nbsp; &nbsp; &nbsp;# Turn on cue LED connected to Ch10</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ServoPosInside(3) &nbsp; # Change the angle of water arm servo connected to Ch3 to inside position</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CreateNormalPanel(0) &nbsp;# Create a white-filled square panel as panel #0</font><br clear="all">
  <br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventTxt = open(Path + &quot;/&quot; + str(TimeNow.year) + &quot;_&quot; + str(TimeNow.month) + &quot;_&quot; + str(TimeNow.day) + &quot; &quot; + str(TimeNow.hour) + &quot;h&quot; + str(TimeNow.minute) + &quot;m Task&quot; + str(GetTaskID()) + &quot; Touch.txt&quot;, 'w') &nbsp;# Initialize the text exporter for a resultfile</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventTxt.write('TrialNum\tResult\t\t\tyyyy/mm/dd\th:m\ts\n') &nbsp;# Write item name on the result file</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventCsv = open(Path + &quot;/&quot; + str(TimeNow.year) + &quot;_&quot; + str(TimeNow.month) + &quot;_&quot; + str(TimeNow.day) + &quot; &quot; + str(TimeNow.hour) + &quot;h&quot; + str(TimeNow.minute) + &quot;m Task&quot; + str(GetTaskID()) + &quot; Touch.csv&quot;, 'w')</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;print(&quot;Task #&quot; + str(GetTaskID()) + &quot; is started at &quot; + str(GetTaskStartedMonth()) + '/' + str(GetTaskStartedDay()) + ' ' + str(GetTaskStartedHour()) + ':' + str(GetTaskStartedMinute()) + ':' + str(GetTaskStartedSecond())) &nbsp;# Enter the start time in the consolewindow of Pycharm</font><br clear="all">
  <br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Timer_Start(5) &nbsp;# Start a timer #5 to measure the duration of the task</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Phase2 = 2 &nbsp;# Start task from the reward phase</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Phase2_Init = 1 # Flag indicating that initialization of Phase2 has done</font><br clear="all">
  <font color="Blue">=================================================================================================================</font><br clear="all">
  <font color="Blue">PutEndTaskNowButton()</font><font color="Black">places “TaskEnd” button on the main window and</font><font color="Blue">mStatusVar.set()</font><font color="Black">command updates the message shown in themain window.</font><br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Blue">mOngoingResult = ttk.Label(MainWindowRightFrame, textvariable=mOngoingResultVar)</font><br clear="all">
  <font color="Blue">mOngoingResult.place(x=10, y=18)</font><br clear="all">
  <br clear="all">
  These lines place a label which shows the text holded in <font color="Blue">mOngoingResultVar</font> in the main window.<br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Blue">MaxCorrectNum=int(MaxCorrectNumVar.get()) &nbsp; # Get the value of &quot;MaxCorrectNumVar&quot; and convert it from string to integer and assigninto variable named &quot;MaxCorrectNum&quot;</font><br clear="all">
  <font color="Blue">TimeLimit = int(TimeLimitVar.get())</font><br clear="all">
  <font color="Blue">LickDur = int(LickDurVar.get())</font><br clear="all">
  <br clear="all">
  A code include a lot of IntVar is difficult to read so values of IntVars for task parameters are assigned to normal int type variables here.<br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Blue">CorrectNum = 0</font><br clear="all">
  <font color="Blue">TaskDur = 0 &nbsp;# This will keep the elapsed time during of task</font><br clear="all">
  <font color="Blue">NowDrinking = 0</font><br clear="all">
  <br clear="all">
  <font color="Black">The variables for the task execution are declared here.</font><br clear="all">
  <br clear="all">
  <br clear="all">
  In the following code initializes task operation. To stimulate the mouse, the task starts from reward phase.<br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Blue">StartRecording()</font><br clear="all">
  <font color="Black">Starts camera capturing.</font><br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Blue">StartLickRecording()</font><br clear="all">
  <font color="Black">Starts lick logging.</font><br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Blue">LightCycleControlOff()</font><br clear="all">
  <font color="Blue">RoofLightOff()</font><br clear="all">
  <font color="Black">To perform the task in dark condition, automatic switching of roof illumination is deactivated and then turn off the ceiling lights.</font><br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Blue">InfraredLightOn()</font><br clear="all">
  <font color="Black">Turn on the IR illumination</font><br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Blue">DigitalOutOn(10)</font><br clear="all">
  <font color="Black">Activate digital I/O Ch10 to illuminate the cue LED.</font><br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Blue">ServoPosInside(3)</font><br clear="all">
  <font color="Black">Water nozzle is moved into the chamber.</font><br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Blue">CreateNormalPanel(0)</font><br clear="all">
  <font color="Black">Panel #0 is created here. Once the panel is created you can show and hide it with</font><font color="Blue">ShowPanel(0)</font><font color="Black">and</font><font color="Blue">HidePanel(0)</font><font color="Black">.</font><br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Blue">Writer_TouchEventTxt = open(Path + &quot;/&quot; + str(TimeNow.year) + &quot;_&quot; + str(TimeNow.month) + &quot;_&quot; + str(TimeNow.day) + &quot; &quot; + str(TimeNow.hour) + &quot;h&quot; + str(TimeNow.minute) + &quot;m Task&quot; + str(GetTaskID()) + &quot; Touch.txt&quot;, 'w') &nbsp;# Initialize the text exporter for a result file</font><br clear="all">
  <br clear="all">
  <font color="Black">This code creates a writer to make a text result file. The first argument is a file name. The ‘</font><font color="Blue">w</font><font color="Black">’ in the second argument sets this writer tobe a writing mode.</font><br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Blue">Writer_TouchEventTxt.write('TrialNum\tResult\t\t\tyyyy/mm/dd\th:m\ts\n') &nbsp;# Write item name on the result file</font><br clear="all">
  <br clear="all">
  <font color="Black">Item names are written in the first line of the text result file. “</font><font color="Blue">\t</font><font color="Black">” means comma.</font><br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Blue">Writer_TouchEventCsv = open(Path + &quot;/&quot; + str(TimeNow.year) + &quot;_&quot; + str(TimeNow.month) + &quot;_&quot; + str(TimeNow.day) + &quot; &quot; + str(TimeNow.hour) + &quot;h&quot; + str(TimeNow.minute) + &quot;m Task&quot; + str(GetTaskID()) + &quot; Touch.csv&quot;, 'w')</font><br clear="all">
  <font color="Black">Result file in CSV format (each value is separated with comma) is also generated in the same way.</font><br clear="all">
  <br clear="all">
  <br clear="all">
  Then timer #5 is started by <font color="Blue">Timer_Start(5)</font>. This timer is used for the time limitation of the task. OperantHouse has total 8 timers (#0-7) and each timer can reset and start with <font color="Blue">Timer_Start(timer#)</font> and get the elapsed time in second with <font color="Blue">Timer_GetSec(timer#)</font>and stop it with <font color="Blue">Timer_End(timer#)</font>.<br clear="all">
  <br clear="all">
  <br clear="all">
  Lastly, Set the <font color="Blue">Phase2</font> to “2” to switch that the current phase is a reward phase. <font color="Blue">Phase2</font> variable holds the transition status within trials. e.g. If <font color="Blue">Phase2==0,</font> the phase is an initialization of the trial. If &nbsp;<font color="Blue">Phase2==1</font>, panel touch phase. If &nbsp;<font color="Blue">Phase2==2</font>, reward phase. If <font color="Blue">Phase2=-1</font>, it goes to the task finish phase.<br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Blue">==========================================================================================</font><br clear="all">
  <font color="Blue">if Phase2 == 0: &nbsp; # Initiation of new trial</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp;TaskDur = Timer_GetSec(5)</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp;ShowPanel(0) &nbsp; &nbsp;# Display panel #0</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp;Phase2 = 1</font><br clear="all">
  <font color="Blue">==========================================================================================</font><br clear="all">
  <font color="Blue">Phase2 == 0</font> is a trial initialization phase. In this phase, elapsed time in this session is updated and the panel #0 is displayed.<br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Blue">==========================================================================================</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if Phase2 == 1: &nbsp; # Panel presentation</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TouchedPanelID = DetectRoiNosepoke() &nbsp;# Examine which panel is touched (return panel ID. If none of the panels touched,return -1)</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if TouchedPanelID == 0: # If mouse touches the panel</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ServoPosInside(3) &nbsp; &nbsp;# Move the water nozzle into inside position</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DigitalOutOn(10) &nbsp; &nbsp;# Onset cue light</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HidePanel(0)</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NowDrinking = 0</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CorrectNum += 1 &nbsp; &nbsp; # Increase the number of correct response</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mOngoingResultVar.set('CorrectNum:' + str(CorrectNum))</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Writer_TouchEventTxt.write(str(CorrectNum)+'\tPanelTouched(Correct)\t'+ str(TimeNow.year)+&quot;/&quot;+str(TimeNow.month)+&quot;/&quot;+str(TimeNow.day)+&quot;\t&quot;+str(TimeNow.hour)+&quot;:&quot;+str(TimeNow.minute)+&quot;\t&quot;+str(TimeNow.second)+&quot;.&quot;+str(TimeNow.microsecond//1000)+&quot;\n&quot;) # Write the response on the text file</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Writer_TouchEventCsv.write(str(CorrectNum) + ',1,' + str(TimeNow.year) + &quot;,&quot; + str(TimeNow.month) + &quot;,&quot; + str(TimeNow.day)+ &quot;,&quot; + str(TimeNow.hour) + &quot;,&quot; + str(TimeNow.minute) + &quot;,&quot; + str(TimeNow.second) + &quot;.&quot; + str(TimeNow.microsecond//1000)+&quot;\n&quot;) &nbsp;#Write the response on the csv file</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Phase2 = 2 &nbsp;# Start reward phase</font><br clear="all">
  <font color="Blue">==========================================================================================</font><br clear="all">
  <font color="Blue">Phase2 == 1</font> is a Panel touch phase. &nbsp;In this phase the program keeps checking whether the panel #0 is touched or not. <font color="Blue">DetectRoiNosepoke()</font> returns the touched panel number so if it returns “1”, that means panel #0 is touched. Otherwise it returns “-1”. After the touch detection, it moves the water nozzle inside to allow water access with cue light and hides the panel. It updates the current result message with &nbsp;<font color="Blue">mOngoingResultVar.set()</font> and updates the result texts with <font color="Blue">Writer_TouchEventTxt.write()</font> and <font color="Blue">Writer_TouchEventCsv.write()</font>. Then it moves to the reward phase (Phase2 == 2).<br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Blue">==========================================================================================</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if Timer_GetSec(5) &gt;= TimeLimit * 60: &nbsp; # If time limit of the task comes</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TaskDur = Timer_GetSec(5)</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(&quot;Time limit elapsed&quot;)</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Timer_End(5) &nbsp; &nbsp;# Stop the timer</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Phase2 = -1</font><br clear="all">
  <font color="Blue">==========================================================================================</font><br clear="all">
  <font color="Black">During</font><font color="Blue">Phase2 == 1</font><font color="Black">, it also checks whether the time limit is exceeded or not. If it does, the phase moves to the task end phase.</font><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Blue">==========================================================================================</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if Phase2 == 2: &nbsp;# Reward phase</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if DetectRoiNosepoke() == 19 and NowDrinking == 0: &nbsp; &nbsp;# If the mouse initiates nose poking</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NowDrinking = 1</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Timer_Start(0) &nbsp;# Start lick timer</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if NowDrinking == 1: &nbsp; &nbsp;# If the nose poke has begun</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if Timer_GetSec(0) &gt;= LickDur: &nbsp; # If the nosepoke duration exceeds the lick duration</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Timer_End(0) # End timer for measuring lick duration</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ServoPosMiddle(3) &nbsp; # Move water nozzle back to the middle position</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DigitalOutOff(10) &nbsp; # Turn off the cue LED</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NowDrinking = 0</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if CorrectNum &lt; MaxCorrectNum: &nbsp;# If the touch number doesn't exceed the maximum number</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Phase2 = 0</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if CorrectNum &gt;= MaxCorrectNum: &nbsp; # If the touch number exceeds the maximum number</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TaskDur = Timer_GetSec(5) &nbsp;# Keep the task time</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Phase2 = -1 # Go to the task finalizing phase</font><br clear="all">
  <font color="Blue">==========================================================================================</font><br clear="all">
  In the reward phase (<font color="Blue">Phase2 == 2</font>), the water nozzle is moved out of the chamber a certain time (2 sec in default) after the nose poke to the water slit is detected.<br clear="all">
  In the first part, it keeps checking if the mouse is detected in the ROI near the water slit using <font color="Blue">DetectRoiNosepoke()</font>. After the detection, the timer #0 is started to measure lick duration and goes to the next part. In the next part, it &nbsp;keeps watching timer #0 with <font color="Blue">Timer_GetSec(0)</font> if the time elapsed exceeds the lick duration and if it does, the nozzle is retracted with <font color="Blue">ServoPosMiddle(3)</font> and cue LED is turned off with <font color="Blue">DigitalOutOff(10)</font>. The touch number (=<font color="Blue">CorrectNum</font>) is checked if it exceeds the touch number limit (MaxCorrectNum) and if it doesn’t, it goes back to the next trial. If it reaches the maximum number of touches, the total task duration is updated and it goes to the session end phase.<br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Blue">==========================================================================================</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if Phase2 == -1 or GetEndTaskNowButtonStat() == 1: &nbsp;# If the flag is set to finish the task</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LightCycleControlOn() &nbsp; # Activate automatic light/dark cycle</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ServoPosMiddle(3) &nbsp; # Moze servo nozzle into middle position</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DeleteAllPanel() &nbsp; &nbsp;# Remove a panel on touch screen</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;InfraredLightOff() &nbsp;# Turn off the infrared LED</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if GetRecordingStat() == 1: # If camera is capturing</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SetEndRecordingTimer(60) &nbsp; &nbsp;# Onset a timer to finish video recording after 60 frames (correspond about 2sec) from now</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Add summary of results into the result file</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventTxt.write('CorrectNum:'+str(CorrectNum)+&quot;\n&quot;)</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventTxt.write('SessionStartTime: ' + str(GetTaskStartedMonth()) + '/' + str(GetTaskStartedDay()) + ' ' + str(GetTaskStartedHour()) + ':' + str(GetTaskStartedMinute()) + ':' + str(GetTaskStartedSecond()) + &quot;\n&quot;)</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventTxt.write('SessionEndTime: ' + str(TimeNow.month) + '/' + str(TimeNow.day) + ' ' + str(TimeNow.hour) + ':' +str(TimeNow.minute) + ':' + str(TimeNow.second + (TimeNow.microsecond // 1000) / 1000) + &quot;\n&quot;)</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventTxt.write('TaskDuration(sec): ' + str(TaskDur) + &quot;\n&quot;)</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Add experimental conditions into the result file</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventTxt.write('MaxCorrectNum: '+str(MaxCorrectNum)+&quot;\n&quot;)</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventTxt.write('TimeLimit: ' + str(TimeLimit) + &quot;\n&quot;)</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventTxt.write('LickDur: ' + str(LickDur)+&quot;\n&quot;)</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventTxt.write('RecordFPS: ' + str(GetRecordFps()) + &quot;\n&quot;) &nbsp;# Recorded frame number per second</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventTxt.write(GetRoiSensitivity() + &quot;\n&quot;) &nbsp;# Settings of each ROI</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventTxt.write(GetServoAngle() + &quot;\n&quot;) &nbsp;# Set angles of each servo</font><br clear="all">
  <br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventTxt.close() &nbsp; &nbsp;# Close the text exporter for the result file</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventCsv.close()</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;EndLickRecording() &nbsp;# End lick log recording</font><br clear="all">
  <br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SendMail(DeviceNameVar.get()+' finished task '+str(GetTaskID())+'. Correct:'+str(CorrectNum)+' Dur:'+str(round(Timer_GetSec(5) / 60,1))+' min','The task is finished.') # Send a email (correct number and task duration are added to email title)</font><br clear="all">
  <br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Phase = 1 &nbsp;# Go back to the task-waiting phase</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Phase2 = 0</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Phase2_Init = 0</font><br clear="all">
  <font color="Blue">==========================================================================================</font><br clear="all">
  <font color="Black">In the task end phase (</font><font color="Blue">Phase2 == -1</font><font color="Black">), the OperantHouse is returned to the standby state and results of the task and experimentalconditions are exported as text files and email is sent.</font><br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Blue">if GetRecordingStat() == 1: # If camera is capturing</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp;SetEndRecordingTimer(60) &nbsp; &nbsp;# Onset a timer to finish video recording after 60 frames (correspond about 2sec) from now</font><br clear="all">
  <br clear="all">
  <font color="Black">After checking if the camera capturing is in progress with</font><font color="Blue">GetRecordingStat()</font><font color="Black">(it returns “1” if the camera is capturing), the recording isset to end after 60 frames using</font><font color="Blue">SetEndRecordingTimer(60)</font><font color="Black">(This delay is necessary to check back later if the nozzle is actually retractedat the end of session).</font><br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Black">The following lines add the summary of the task results as shown below (“\n” is a line break).</font><br clear="all">
  <img src="paste2503.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Black">The following are task conditions.</font><br clear="all">
  <img src="paste2513.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  Then it finalizes the text export by <font color="Blue">Writer_TouchEventTxt.close()</font> and <font color="Blue">Writer_TouchEventCsv.close()</font>.<br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Black">After stopping lick logging, it sends an email with</font><font color="Blue">SendMail(“title” , “body text”)</font><font color="Black">(The first argument is the title and the second one is thebody text of the e-mail).</font><br clear="all">
  <img src="paste249.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Blue">SetDispVariable(0, 'Phase2', str(Phase2))</font><br clear="all">
  <font color="Black">The last line is a command to display the values of the variables in the lower right corner of the main window.</font><br clear="all">
  <img src="paste2512.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  It should be better to show an example than explaining to understand how it works.<br clear="all">
  If you command like this,<br clear="all">
  <font color="Blue">SetDispVariable(0, 'Color', Red)</font><br clear="all">
  <font color="Blue">SetDispVariable(2, 'Texture', Rough)</font><br clear="all">
  <font color="Blue">SetDispVariable(1, 'Size', 1m)</font><br clear="all">
  <br clear="all">
  The following message will appear,<br clear="all">
  <font color="Green">Color:Red Size:1m Texture:Rough</font><br clear="all">
 <br clear="all">
  The first argument must be an integer from 0-9.<br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  I guess you probably won't be able to understand the code just by reading. Please try to modify the code yourself and see how it changes the behavior of the device. In the next chapter, I will explain how to create a more complex task by modifying the task 90.</div>
  </div>
  <div id="footer">operanthouseのフッター</div>
  <div id="HPZLPPageTail" style="clear: both;"></div></div>
</body>

</html>
