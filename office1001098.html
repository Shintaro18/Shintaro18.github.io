<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="ja">

<!--2026/02/10 17:56:20-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=Shift_JIS">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <meta http-equiv="Content-Script-Type" content="text/javascript">
  <meta name="GENERATOR" content="ホームページV4">
  <title>Miniscope解析 - Kitaya lab</title>
  <link rel="stylesheet" href="02_white_a0_0010.css" type="text/css" media="all">
</head>

<body>
  <div id="page">
  <div id="header">operanthouseのヘッダー</div>
  <div id="title">
  <h1>Kitaya lab</h1></div>
  <div id="menubar"><div class="mainmenu"><ul><li class="mainmenulistitem"><span class="mainmenuitem"><span class="mainmenuitemright"><span class="mainmenuitemcenter"><a href="index.html" class="mainmenuitemlink"><span class="mainmenuitemmark">オペラントハウスとは</span></a></span></span></span></li><li class="mainmenulistitem"><span class="mainmenuitem"><span class="mainmenuitemright"><span class="mainmenuitemcenter"><a href="office1001038.html" class="mainmenuitemlink"><span class="mainmenuitemmark">What's Operant House?</span></a></span></span></span></li><li class="mainmenulistitem"><span class="mainmenuitem"><span class="mainmenuitemright"><span class="mainmenuitemcenter"><a href="profile1.html" class="mainmenuitemlink"><span class="mainmenuitemmark">行動解析君とは?</span></a></span></span></span></li><li class="mainmenulistitem"><span class="mainmenuitem"><span class="mainmenuitemright"><span class="mainmenuitemcenter"><a href="profile1076.html" class="mainmenuitemlink"><span class="mainmenuitemmark">Mr. Behavio?</span></a></span></span></span></li><li class="mainmenulistitem"><span class="mainmenuitem"><span class="mainmenuitemright"><span class="mainmenuitemcenter"><a href="profile1001.html" class="mainmenuitemlink"><span class="mainmenuitemmark">Gait analyzer</span></a></span></span></span></li><li class="mainmenulistitem"><span class="mainmenuitem"><span class="mainmenuitemright"><span class="mainmenuitemcenter"><a href="privacy1.html" class="mainmenuitemlink"><span class="mainmenuitemmark">プライバシーポリシー</span></a></span></span></span></li></ul>
</div></div>
  <div id="side1">
  <div class="submenu"><ul><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="index.html" class="submenuitemlink"><span class="submenuitemmark1">オペラントハウスとは?</span></a></span></span></span></li><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001.html" class="submenuitemlink"><span class="submenuitemmark1">制作の準備(ﾀﾞｳﾝﾛｰﾄﾞ)</span></a></span></span></span></li><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="99_blank.html" class="submenuitemlink"><span class="submenuitemmark1">3Dプリンターの準備</span></a></span></span></span></li><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="99_blank001.html" class="submenuitemlink"><span class="submenuitemmark1">オペラントハウスの製作</span></a></span></span></span></li><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="99_blank002.html" class="submenuitemlink"><span class="submenuitemmark1">オプションパーツについて</span></a></span></span></span></li><li><span class="submenuitem" style="margin-left:10px;"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001027.html" class="submenuitemlink"><span class="submenuitemmark2">赤外線カメラ検出</span></a></span></span></span></li><li><span class="submenuitem" style="margin-left:10px;"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001028.html" class="submenuitemlink"><span class="submenuitemmark2">ｵﾌﾟｼｮﾝﾊﾟｰﾂ(ﾚﾊﾞｰ)</span></a></span></span></span></li><li><span class="submenuitem" style="margin-left:10px;"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001029.html" class="submenuitemlink"><span class="submenuitemmark2">赤外線センサーバー検出</span></a></span></span></span></li><li><span class="submenuitem" style="margin-left:10px;"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001016.html" class="submenuitemlink"><span class="submenuitemmark2">操作用モニタの追加</span></a></span></span></span></li><li><span class="submenuitem" style="margin-left:10px;"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001098.html" class="submenuitemlink"><span class="submenuitemmark2">UCLA Miniscope</span></a></span></span></span></li><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001018.html" class="submenuitemlink"><span class="submenuitemmark1">ｵﾍﾟﾗﾝﾄﾊｳｽの使い方</span></a></span></span></span></li><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="99_blank003.html" class="submenuitemlink"><span class="submenuitemmark1">オリジナル課題の追加</span></a></span></span></span></li><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001036.html" class="submenuitemlink"><span class="submenuitemmark1">Command list</span></a></span></span></span></li><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001069.html" class="submenuitemlink"><span class="submenuitemmark1">デフォルト課題の説明</span></a></span></span></span></li><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001010.html" class="submenuitemlink"><span class="submenuitemmark1">Tips</span></a></span></span></span></li><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001037.html" class="submenuitemlink"><span class="submenuitemmark1">トラブルシューティング</span></a></span></span></span></li><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001103.html" class="submenuitemlink"><span class="submenuitemmark1">About copyright</span></a></span></span></span></li><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001070.html" class="submenuitemlink"><span class="submenuitemmark1">Go to English page</span></a></span></span></span></li></ul>
</div></div>
  <div id="side2"></div>
  <div id="main_wrapper000" class="HPZAutoMarginAdjuster">
  <div id="main">
  <h1>Miniscope解析</h1>
  <hr>
  <br clear="all">
  <h2><br class="HPZAutoBR"></h2>
  <h2>【概要】</h2>
  オペラントハウスではヘッドマウント型蛍光顕微鏡であるUCLA大学のMiniscope v4を用いてin vivo calcium imagingを使う事ができます。<br clear="all">
  in vivo imagingではイメージングデータと行動のデータを同期させるため、miniscopeと共にオペラントハウスの制御もPCで行います。動作が確認されているOSはWindows 8.1/10です。確認はしてませんがWindows 11でも動くと思います。<br clear="all">
  また天井にはケーブルのねじれを取るスリップリングが追加されます。<br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <h4><img src="paste342.jpg" alt="" border="0"></h4>
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <h2>【必要な物】</h2>
  紫外線硬化接着剤 or エポキシ系接着剤<br clear="all">
  HDMI(オス) - DisplayPort(オス)ケーブル　　(もしPCにDisplayPortしかない場合)<br clear="all">
  <h2><br class="HPZAutoBR"></h2>
  <h2><br class="HPZAutoBR"></h2>
  <h2><br class="HPZAutoBR"></h2>
  <h2>【スリップリングの製作】</h2>
  <h2><br class="HPZAutoBR"></h2>
  まずはminiscope - スリップリング - DAQ boardを繋ぐ配線を作りましょう。<br clear="all">
  <br clear="all">
  <br clear="all">
  <b>＜ケーブルの準備＞</b><br clear="all">
  まずは上図①のケーブルを作ります。<br clear="all">
  ケーブルは細くて柔らかい<b>COONER WIRE社</b>の<b>CW2040-3650 SR</b>を使います。<br clear="all">
  <img src="paste345.jpg" alt="" height="393" width="332" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  まず22cmの長さに切ります。<br clear="all">
  <img src="paste3462.jpg" alt="" height="342" width="332" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  下図はCoaxialケーブルの断面図ですが、陰極が陽極を覆う構造になっています。<br clear="all">
  Coaxialケーブルはこの構造によりシグナルを電磁波ノイズから守っています。<br clear="all">
  <img src="paste346.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  外側の被膜を剥きます。<br clear="all">
  <img src="paste349.jpg" alt="" height="123" width="220" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  先のとがったピンセットなどで繊維をほどきます。<br clear="all">
  <img src="paste348.jpg" alt="" height="114" width="219" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  繊維をほどくと細いビニル被膜された線が見えてくると思います。これがプラス極です。<br clear="all">
  陽極以外の繊維はマイナス極なのでこれらをねじって束ねます。<br clear="all">
  <img src="paste350.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  次は少々難しいですが、プラス極の先端の被膜を剥きます。<br clear="all">
  ニッパーで被膜の端に少しだけ傷を付けてからニッパーで剥き上げると上手く行きます。<br clear="all">
  この作業は拡大鏡や実体顕微鏡下で行うと楽です。<br clear="all">
  <img src="paste3512.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  次にMiniscopeへ接続するためのHiroseコネクター（雌）をハンダ付けしましょう。<br clear="all">
  両面テープを机にはり、その上にHiroseコネクターを付けます。<br clear="all">
  この作業は裸眼でも不可能ではないですが、拡大鏡か実体顕微鏡下で行う事を強くお勧めします。<br clear="all">
  丸で囲った部分はプラス極でそれ以外の金色の部分は全てマイナス極です。<br clear="all">
  <img src="paste35313.jpg" alt="" height="184" width="220" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  フレキシブルアームを用いてケーブルを丁度よい位置にセットしてハンダ付けを行います。<br clear="all">
  ハンダ付け後にショートしてないかテスターで確かめることを忘れないでください。<br clear="all">
  <img src="paste354.jpg" alt="" height="283" width="426" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  このままだと強度的に弱いので紫外線硬化接着剤（もしくはエポキシ接着剤）でプラス極の線を中心に補強します。<br clear="all">
  この時コネクターの接続部を下にすると接着剤が接続部に流れて行き接点不良になる危険があるため、写真のように接続部は上を向けてください。<br clear="all">
  （紫外線硬化接着剤は固まるまで待たなくて良いのでお勧め）<br clear="all">
  <img src="paste3641.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <b>＜スリップリングの改造と接続＞</b><br clear="all">
  次にスリップリングの改造を行います。<br clear="all">
  スリップリングの原理は以下の通りで、中に回転する伝導体のドラム（青）とそれに接触する電極（赤）があり、ドラムが回転しても電極は接触し続けるため電気的な接続をキープできます。<br clear="all">
  <img src="paste355.jpg" alt="" height="142" width="279" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  使用するスリップリング、<b>775 (Adafruit industries)</b>ですが、軸を手で回転させるとそこそこ強い抵抗を感じると思います。<br clear="all">
  これは775はラインが6つあり、1ラインにつき電極が2本あるため合計12本の電極がドラムをこすっているためです。<br clear="all">
  しかしながらMiniscopeは2ラインしか使わないため残りの4ラインは不要なのでまずはこれらを除去します。<br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  まず余分な長さの配線を切ります。<br clear="all">
  <img src="paste356.jpg" alt="" height="170" width="418" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  次にプラスティックのカバーを除去します。<br clear="all">
  スリップリングの上部に隙間が見えると思います。この隙間にニッパーを差し込んでカバーを破壊していきます。<br clear="all">
  <img src="paste362.jpg" alt="" height="208" width="152" border="0">　　<img src="paste3581.jpg" alt="" border="0">　　<br clear="all">
  <br clear="all">
  <img src="paste360.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <img src="paste361.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <img src="paste352.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <img src="paste357.jpg" alt="" border="0"><br clear="all">
  取れました。<br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  次にスリップリングを分解します。本体を２つに割りましょう。ドラムは持ち上げれば外れます。<br clear="all">
  それぞれ3対の電極が立っているのが見えると思います。1対が1ラインに対応しています。<br clear="all">
  Miniscopeでは2ラインのみ必要なので赤で囲ったラインを除去しましょう。<br clear="all">
  <img src="paste3591.jpg" alt="" height="215" width="439" border="0"><br clear="all">
  <img src="paste3631.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  不要なラインを写真のように外側に曲げてドラムに接触しなくさせます（真ん中のラインは触らないように注意！）。<br clear="all">
  <img src="paste366.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  作業が終わったら組み立て直し、テープで巻いて固定します。<br clear="all">
  軸回転の抵抗が減っていればスリップリングの改造は完了です。<br clear="all">
  <img src="paste358.jpg" alt="" height="296" width="491" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  Coaxialケーブルのスリップリング側を先ほどと同じ作業により被膜を除き、露出させます。<br clear="all">
  そしてスリップリングにハンダ付けします。そしてショートしてないか確認します。<br clear="all">
  <img src="paste359.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  接着剤で強度的に弱い部分を補強します。<br clear="all">
  <img src="paste363.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  これで①のラインは完成です。次は②のスリップリング-DAQ間の配線作成です。<br clear="all">
  Coaxialケーブルを20cmの長さに切り、両端を露出させます。<br clear="all">
  <br clear="all">
  <br clear="all">
  <img src="paste3754.jpg" alt="" height="340" width="490" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  スリップリングにハンダ付けして接着剤で補強します。<br clear="all">
  <img src="paste365.jpg" alt="" border="0"><br clear="all">
  <img src="paste367.jpg" alt="" height="276" width="441" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  この場所にストレスが集中しないように6mm熱収縮チューブも付けます。<br clear="all">
  <img src="paste373.jpg" alt="" height="188" width="271" border="0"><img src="paste368.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  次に反対側をSMAコネクターにハンダ付けし、ショートしてないかの確認後、接着剤を付け、熱収縮チューブを付けます。<br clear="all">
  ハンダ付け後に熱収縮チューブを入れる事はできないので前もって配線に通しておいてください。<img src="paste370.jpg" alt="" height="216" width="617" border="0"><br clear="all">
  <br clear="all">
  <img src="paste369.jpg" alt="" height="229" width="617" border="0"><br clear="all">
  <br clear="all">
  <img src="paste340.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  Miniscopeに接続したら完成です。<br clear="all">
  <img src="paste351.jpg" alt="" height="606" width="771" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <h2>【ホルダーの製作】</h2>
  <br clear="all">
  次にスリップリングとDAQボード（Data acquisition board）をオペラントハウスに固定するため、左メニューの製作の準備ページ(ﾀﾞｳﾝﾛｰﾄﾞ)からダウンロードできる3Dプリンタデータの<b>Option parts/Miniscope</b>フォルダにある以下のパーツを印刷します。<br clear="all">
  <br clear="all">
  - Commutator holder.stl<br clear="all">
  - DAQ holder.stl<br clear="all">
  <br clear="all">
  左がスリップリング、右がDAQボードを入れるスロットです。<br clear="all">
  <img src="paste338.jpg" alt="" height="259" width="290" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  これらスロットをオペラントハウスのフタに固定しましょう。<br clear="all">
  <br clear="all">
  [カメラ検出の場合]<br clear="all">
  <img src="paste3532.jpg" alt="" height="323" width="418" border="0"><br clear="all">
  <br clear="all">
  [IRセンサーバー検出の場合]<br clear="all">
  <img src="paste3751.jpg" alt="" height="281" width="417" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  ここではIRセンサーバー検出用のフタを用いて解説します。<br clear="all">
  <br clear="all">
  スリップリングをホルダーに設置します。<br clear="all">
  <img src="paste374.jpg" alt="" height="313" width="273" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  2mmのネジでスロットを固定します。<br clear="all">
  <img src="paste3752.jpg" alt="" height="318" width="488" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  DAQ boardを設置します。<br clear="all">
  <img src="paste376.jpg" alt="" height="308" width="489" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <h2>【PCの準備と接続】</h2>
  <br clear="all">
  <br clear="all">
  性能がそれなりに良いWindows PCを準備します。<br clear="all">
  PythonパッケージであるANACONDAのサイト(https://www.anaconda.com/download)からDistribution Installerをダウンロードし、インストールします。<br clear="all">
  <br clear="all">
  <br clear="all">
  オペラントハウスではいくつかのプラグインを導入する必要があるため、元のpythonを汚さないよう、virtual environmentの設定をしましょう。<br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <b>[Virtual environment]</b><br clear="all">
  Anaconda Promptを起動します。<br clear="all">
  <br clear="all">
  <br clear="all">
  以下の文字をタイプしてOperaEnvという名前の仮想環境を作ります。<br clear="all">
  <img src="paste377.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  次に作成した環境をONにします。<br clear="all">
  <img src="paste378.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  これにより、pythonプログラムを実行する際にはOperaEnvを使うようになります。<br clear="all">
  ちなみにこの仮想環境は<b>Cドライブ &gt; Users &gt; ユーザー名 &gt; .conda &gt; envs</b>に保存されています。<br clear="all">
  <br clear="all">
  <br clear="all">
  では次にプラグインを入れて行きましょう。<br clear="all">
  まずはUSBカメラをキャプチャーするため<b>OpenCV</b>を導入します。<br clear="all">
  <img src="paste382.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  次にArduinoとのシリアル接続のための<b>pyserial</b>を導入します。<br clear="all">
  <img src="paste383.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  さらに<b>win32api</b>もインストールします。<br clear="all">
  <img src="paste353.jpg" alt="" height="27" width="454" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  これでpython側の設定は完了です。<br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <b>[オペラントハウス]</b><br clear="all">
  次はオペラントハウスのコードをPC用に変えましょう。<br clear="all">
  メモ帳でオペラントハウスのプログラムを開き、<b>General setting</b>の<b>RaspberryMode</b>の値を<b>0</b>にします。<br clear="all">
  <img src="paste3533.jpg" alt="" height="102" width="771" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  制御コンピュータをラズパイからPCへ変更するため、ArduinoのUSBケーブルの接続先をラズパイからPCへ変えます。またUSBカメラもPCに接続してください。<br clear="all">
  赤外線センサーバーを使っている場合はそれもPCに接続してください。<br clear="all">
  <br clear="all">
  次にPCがどのポートでArduinoを認識したか調べます。<br clear="all">
  コントロールパネルからデバイスマネージャーを開いてください。<br clear="all">
  <img src="paste3753.jpg" alt="" border="0"><br clear="all">
  赤で囲った所がポート番号です。この中の<b>USB serial Device (COM6)</b>がArduinoです。もしどれか分からない場合はArduinoからUSBケーブルを抜いてどの番号が消えるかで確かめてください。<br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  次にオペラントハウスで設定されたポート番号を確認します。<br clear="all">
  <img src="paste3811.jpg" alt="" height="201" width="809" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  ポート番号が<b>COM3</b>となっているのでこれを<b>COM6</b>に変えます。<br clear="all">
  <img src="paste386.jpg" alt="" height="188" width="809" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  もしカメラを内蔵したノートPCを使っている場合は、デバイスマネージャーでdeactivateしておいてください。<br clear="all">
  <img src="paste3755.jpg" alt="" height="296" width="356" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  [Miniscope]<br clear="all">
  今回の実験ではMiniscope側のソフトで行動カメラをキャプチャーする必要がないため、Miniscope側のソフトのconfig fileを変え、Behavior cameraキャプチャーをオフにする必要があります。<br clear="all">
  MiniscopeのデフォルトのConfigfileである<b>UserConfigExample-V4-Miniscope-plus-WebCam.json</b>をメモ帳で開き、赤で囲った<b>&quot;cameras&quot;</b>の項目を削除してください。<br clear="all">
  <img src="paste37911.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  削除後、このようになっていればOKです。<img src="paste380.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  これで全ての準備ができました。<br clear="all">
  ソフトの起動もAnacondaから行います。<br clear="all">
  AnacondaでOperaEnvをactivateし、cdコマンドを使ってカレントディレクトリをオペラントハウスのフォルダに移します(パスは環境毎に異なります)。<br clear="all">
  <img src="paste381.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  次にpythonコマンドを使ってオペラントハウスのコードを実行します（最後のプログラムのファイル名はバージョンアップで変わるので、あなたのフォルダ内にあるファイル名にしてください）。<br clear="all">
  <img src="paste384.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  オペラントハウスが起動したら次にMiniscopeのソフトを起動し、Miniscopeの画像が正常にキャプチャーされるかチェックします。<br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <i>&lt;もし表示されない場合&gt;<br clear="all">
  カメラIDの設定が間違っている可能性があるので（現状オペラントハウスのカメラは0, Miniscopeは1のカメラIDが割り振られている前提の設定）、カメラIDを以下の手順で入れ替えてください。<br clear="all">
  <br clear="all">
  オペラントハウスのソースコードのCameraIDを1に変更　　　　　　<img src="paste3771.jpg" alt="" height="226" width="809" border="0"><br clear="all">
  <br clear="all">
  MiniscopeのconfigファイルのdeviceIDを0にする<br clear="all">
  <img src="paste3782.jpg" alt="" border="0"><br clear="all">
  カメラIDの割り振りは同じ接続パターンであれば基本的に同じですが、変わる可能性もゼロではないので不具合が出たらカメラIDの入れ替えを試してみてください。</i><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  オペラントハウスの天井カメラとMiniscopeの両方でキャプチャーでき、オペラントハウスソフトは30fpsで動き、Miniscopeはframe dropが立ち上げ後に増加していなければ成功です（オペラントハウスの保存パスを忘れず設定してください）。<br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <h2>【赤外線センサーバーのリファレンス（赤外線センサーバーを使用している場合のみ）】</h2>
  カメラでパネルタッチを検出している場合はここをスキップしてください。<br clear="all">
  またここではラズパイですでに赤外線センサーバーを使用した経験がある前提で解説を行います。もし未経験の場合は左メニューのオプションパーツについて＞赤外線センサーバー検出を前もって読んでおいてください。<br clear="all">
  <br clear="all">
  <br clear="all">
  タッチモニター、Arduino、天井カメラ、赤外線センサーバーをPCに接続してください。<br clear="all">
  デスクトップを右クリックして画面設定を開き、タッチモニターをメインモニタの右側に拡張画面として置いてください。<br clear="all">
  <img src="paste3643.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  PCで赤外線センサーバーを使う場合も基本的にはラズパイでのやり方と変わりません。しかしながらWindows11で赤外線センサーバーを使うとなぜかメイン画面（オペレーション画面）の右側のエリアでマウスポインタが動いてしまいます。このエリアを今後センサーバーエリアと呼びます。<br clear="all">
  <img src="paste379.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  このままだとマウスがパネルをタッチすることでWindowsのタスクバーを操作してしまう危険性があるため、まずタスクバーを左に動かします。<br clear="all">
  Windows11はデフォルトではタスクバーを動かせないのでStartAllBackというソフトでインターフェイスをWindows10風に戻します。<br clear="all">
  このソフトはMicrosoft Storeに置いてあります。<br clear="all">
  <img src="paste385.jpg" alt="" height="382" width="426" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  インストールすると直ぐにデスクトップがWindows10風になると思います。<br clear="all">
  <img src="paste387.jpg" alt="" border="0"><br clear="all">
  （スタートボタンが左に来る）<br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  タスクバーを右クリックして<b>Properties</b>を選びます。<br clear="all">
  <img src="paste388.jpg" alt="" height="156" width="284" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  Taskbar location on screenを左にします。<br clear="all">
  <img src="paste3901.jpg" alt="" height="397" width="584" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  これでタスクバーが左に移動しました。なおこの<b>StartAlllBack</b>は最初の100日は無料で使えますが、その後有料になります・・・。（7ドル程度の買い切りですが）<br clear="all">
  <img src="paste3961.jpg" alt="" height="291" width="369" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  またタスクバーがタッチモニターに表示されている場合はタスクバーを右クリックして設定を出し、<b>タスクバー</b>項目の<b>タスクバーを全てのディスプレイに表示する</b>をオフにしてください。<br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  赤外線センサーバーはWindowsではペン/タッチデバイスとして認識されています。ペン/タッチデバイスでは長押しするとマウスの右クリックと見なされるためこの機能をオフにします。<br clear="all">
  <b>コントロールパネル→Pen and Touch→Press and hold</b>を選び、設定ボタンを押し、<b>Enable press and hold for right-clicking</b>のチェックを外してください。<br clear="all">
  (Pen and Touchは赤外線センサーバーを接続しないと現れません)<br clear="all">
  <br clear="all">
  <img src="paste3756.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <img src="paste3642.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <img src="paste3902.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  次に赤外線センサーバーでマウスカーソルを動く範囲をタッチウィンドウでカバーします。こうしないとマウスがタッチウィンドウ以外の場所をクリックして、タッチウィンドウが非アクティブになってしまい、オペラントハウスがマウスカーソルの位置のトラッキングを中断してしまうためです。<br clear="all">
  オペラントハウスのコードの<b>General setting</b>を見てください。<br clear="all">
  <img src="paste36431.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  PCのモニターより<b>OperationMonitorWidth</b>の値を小さくするとタッチウィンドウが操作画面にはみ出してきます。またその下の<b>OperationMonitorHeight</b>の数値を増やすことでタッチウィンドウが下に伸びます。これらの数値をいじり、タッチウィンドウがセンサーバーエリアをカバーするようにしてください。<br clear="all">
  <img src="paste3758.jpg" alt="" height="272" width="831" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  そうするとタッチウィンドウが左に動いて今度はタッチモニターの右側が空いてしまうと思います。そこを空かないように<b>TouchMonitorWidth</b>の値を大きくします。<br clear="all">
  <img src="paste3757.jpg" alt="" height="364" width="335" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  この作業が終わったら下のようになっているはずです。<br clear="all">
  <img src="paste375.jpg" alt="" height="272" width="831" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  次にタッチポイントのリファレンスを行います。現状だとタッチパネルをタッチしても指の下にオレンジのドットが現れないと思います。<br clear="all">
  これはラズパイとWindowsでは赤外線センサーバーの座標が異なるからです。<br clear="all">
  オペラントハウスを起動して<b>Setting</b>ボタンを押してください。四角で示したパラメータを調整します。<br clear="all">
  調整の仕方はラズパイ使用時に行った左メニューの「オプションパーツ→赤外線センサーバー検出」のやり方と同じです。<br clear="all">
  まずは<b>TouchOffset</b>でオレンジドットの位置をシフトさせます。Xは数値を大きくすると右へ、Yは数値を小さくすると下へシフトします。<br clear="all">
  ドットがタッチウィンドウの中に現れるようになったら次に<b>TouchRatio</b>を調整します。タッチした指の動きよりドットの動きが速い場合は<b>TouchRatio</b>の値を下げてください。<br clear="all">
  <img src="paste3891.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  指を動かしてもドットがピタリと指の下を追従するようになれば調整完了です。<br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  最後に使う課題のパネルの位置を調整します。これはラズパイでのやり方と同一なのでここでは解説を省きます。<br clear="all">
  パネルの位置合わせが終わったら赤外線センサーバーのリファレンスは完了です。<br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <h2>【テスト】</h2>
  Miniscopeでキャプチャーを開始し、オペラントハウスの課題を「スタート」ボタンで手動スタートしてください。<br clear="all">
  両ソフト共にタイムスタンプはWindowsの時計を使っているのでTTL信号などで同期させる必要はありません。<br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  </div>
  </div>
  <div id="footer">operanthouseのフッター</div>
  <div id="HPZLPPageTail" style="clear: both;"></div></div>
</body>

</html>
