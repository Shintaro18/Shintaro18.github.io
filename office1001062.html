<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="ja">

<!--2026/02/10 17:56:25-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=Shift_JIS">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <meta http-equiv="Content-Script-Type" content="text/javascript">
  <meta name="GENERATOR" content="ホームページV4">
  <title>7. Modifying Code part1 - Kitaya lab</title>
  <link rel="stylesheet" href="02_white_a0_0010.css" type="text/css" media="all">
</head>

<body>
  <div id="page">
  <div id="header">operanthouseのヘッダー</div>
  <div id="title">
  <h1>Kitaya lab</h1></div>
  <div id="menubar"><div class="mainmenu"><ul><li class="mainmenulistitem"><span class="mainmenuitem"><span class="mainmenuitemright"><span class="mainmenuitemcenter"><a href="index.html" class="mainmenuitemlink"><span class="mainmenuitemmark">オペラントハウスとは</span></a></span></span></span></li><li class="mainmenulistitem"><span class="mainmenuitem"><span class="mainmenuitemright"><span class="mainmenuitemcenter"><a href="office1001038.html" class="mainmenuitemlink"><span class="mainmenuitemmark">What's Operant House?</span></a></span></span></span></li><li class="mainmenulistitem"><span class="mainmenuitem"><span class="mainmenuitemright"><span class="mainmenuitemcenter"><a href="profile1.html" class="mainmenuitemlink"><span class="mainmenuitemmark">行動解析君とは?</span></a></span></span></span></li><li class="mainmenulistitem"><span class="mainmenuitem"><span class="mainmenuitemright"><span class="mainmenuitemcenter"><a href="profile1076.html" class="mainmenuitemlink"><span class="mainmenuitemmark">Mr. Behavio?</span></a></span></span></span></li><li class="mainmenulistitem"><span class="mainmenuitem"><span class="mainmenuitemright"><span class="mainmenuitemcenter"><a href="profile1001.html" class="mainmenuitemlink"><span class="mainmenuitemmark">Gait analyzer</span></a></span></span></span></li><li class="mainmenulistitem"><span class="mainmenuitem"><span class="mainmenuitemright"><span class="mainmenuitemcenter"><a href="privacy1.html" class="mainmenuitemlink"><span class="mainmenuitemmark">プライバシーポリシー</span></a></span></span></span></li></ul>
</div></div>
  <div id="side1">
  <div class="submenu"><ul><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001038.html" class="submenuitemlink"><span class="submenuitemmark1">What's Operant House?</span></a></span></span></span></li><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001039.html" class="submenuitemlink"><span class="submenuitemmark1">Preparation(Download)</span></a></span></span></span></li><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="99_blank004.html" class="submenuitemlink"><span class="submenuitemmark1">Production of the OperantHouse</span></a></span></span></span></li><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="99_blank005.html" class="submenuitemlink"><span class="submenuitemmark1">About Option Parts</span></a></span></span></span></li><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001055.html" class="submenuitemlink"><span class="submenuitemmark1">Handling of OperantHouse</span></a></span></span></span></li><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="99_blank006.html" class="submenuitemlink"><span class="submenuitemmark1">Custom task</span></a></span></span></span></li><li><span class="submenuitem" style="margin-left:10px;"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001056.html" class="submenuitemlink"><span class="submenuitemmark2">1. Preparation</span></a></span></span></span></li><li><span class="submenuitem" style="margin-left:10px;"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001057.html" class="submenuitemlink"><span class="submenuitemmark2">2. Overview of the code</span></a></span></span></span></li><li><span class="submenuitem" style="margin-left:10px;"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001058.html" class="submenuitemlink"><span class="submenuitemmark2">3. About &quot;Phase 0&quot;</span></a></span></span></span></li><li><span class="submenuitem" style="margin-left:10px;"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001059.html" class="submenuitemlink"><span class="submenuitemmark2">4. About &quot;Save&quot;</span></a></span></span></span></li><li><span class="submenuitem" style="margin-left:10px;"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001060.html" class="submenuitemlink"><span class="submenuitemmark2">5. About &quot;Phase 1&quot;</span></a></span></span></span></li><li><span class="submenuitem" style="margin-left:10px;"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001061.html" class="submenuitemlink"><span class="submenuitemmark2">6. About &quot;Phase2&quot;</span></a></span></span></span></li><li><span class="submenuitem" style="margin-left:10px;"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001062.html" class="submenuitemlink"><span class="submenuitemmark2">7. Modifying Code part1</span></a></span></span></span></li><li><span class="submenuitem" style="margin-left:10px;"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001048.html" class="submenuitemlink"><span class="submenuitemmark2">8. Modifying Code part2</span></a></span></span></span></li><li><span class="submenuitem" style="margin-left:10px;"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001065.html" class="submenuitemlink"><span class="submenuitemmark2">9. Modifying Code for Lever</span></a></span></span></span></li><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001072.html" class="submenuitemlink"><span class="submenuitemmark1">Command list</span></a></span></span></span></li><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001073.html" class="submenuitemlink"><span class="submenuitemmark1">Default tasks</span></a></span></span></span></li><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001063.html" class="submenuitemlink"><span class="submenuitemmark1">Tips</span></a></span></span></span></li><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001064.html" class="submenuitemlink"><span class="submenuitemmark1">Troubleshooting</span></a></span></span></span></li><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001102.html" class="submenuitemlink"><span class="submenuitemmark1">Copyright</span></a></span></span></span></li><li><span class="submenuitem"><span class="submenuitemright"><span class="submenuitemcenter"><a href="office1001071.html" class="submenuitemlink"><span class="submenuitemmark1">日本語ページへ</span></a></span></span></span></li></ul>
</div></div>
  <div id="side2"></div>
  <div class="HPZAutoMarginAdjuster" id="main_wrapper000">
  <div id="main">
  <h1>7. Modifying Code part1</h1>
  <br clear="all">
  <br clear="all">
  This chapter explains how to add a new task (task 91) where the right or left panel is lit and touching the lit panel is rewarded while the touching of the non-lit panel is punished.<br clear="all">
  <img src="paste4.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <font color="MidnightBlue">def PutTaskButton():</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp;ButtonWidth = 12</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp;Row=0</font><br clear="all">
  <br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp;・・・</font><br clear="all">
  <br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp;bTask50 = ttk.Button(MainWindowRightFrame, text='ProbRevers(50)', command=functools.partial(SwitchToSelectedTask, 50), width=ButtonWidth).grid(row=Row, column=Column)</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp;Column += 1</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp;bTask90 = ttk.Button(MainWindowRightFrame, text='Test(90)', command=functools.partial(SwitchToSelectedTask, 90), width=ButtonWidth).grid(row=Row, column=Column)</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp;Column += 1</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp;bTask91 = ttk.Button(MainWindowRightFrame, text='Test2(91)', command=functools.partial(SwitchToSelectedTask, 91), width=ButtonWidth).grid(row=Row, column=Column)</font><br clear="all">
 &nbsp; &nbsp;<font color="MidnightBlue">return</font><br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  First, create a button for the task 91 in the task selection with the following code (the blue code is the additional part),<br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Black">The task #91 is added.</font><br clear="all">
  <img src="paste510.jpg" alt="" height="158" width="452" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <font color="MidnightBlue">def SwitchToSelectedTask(ChosenTask): &nbsp; # Initialize for the starting of the task</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp;global Task, Phase, DispVariable</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp;Task = ChosenTask</font><br clear="all">
  <br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp;・・・</font><br clear="all">
  <br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp;Task50()</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp;if Task == 90:</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp;Task90()</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp;if Task == 91:</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp;Task91()</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp;return</font><br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  Next, add a code which is executed when the new button is clicked,<br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Black">Now it jumps to the task 91 function when the task 91 button is clicked. Next step is an addition of the task #91 function. Copy and pastethe task 90 as a base of the task 91 as shown below.</font><br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <font color="MidnightBlue">def Task90(): &nbsp; # Test task</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp;global Phase</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp;Phase0_Init = 0</font><br clear="all">
  <br clear="all">
  <font color="MidnightBlue">・・・</font><br clear="all">
  <br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SetDispVariable(0, 'Phase2', str(Phase2)) &nbsp;# Display &quot;Phase2&quot; value on the bottom of main window</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp;return</font><br clear="all">
  <br clear="all">
  <font color="Blue">def Task91(): &nbsp; # Test2 task</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp;global Phase</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp;Phase0_Init = 0</font><br clear="all">
  <br clear="all">
  <font color="Blue">・・・</font><br clear="all">
  <br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SetDispVariable(0, 'Phase2', str(Phase2)) &nbsp;# Display &quot;Phase2&quot; value on the bottom of main window</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp;return</font><br clear="all">
  <br clear="all">
  <font color="MidnightBlue">def StartRecording(): &nbsp; # Start camera caputring</font><br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Black">This task has additional 2 task parameters so add those parameters to the code and change the position of other task buttons accordingly.</font><br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <font color="MidnightBlue">MaxCorrectNumVar = IntVar(MainWindowRoot) &nbsp;# Declare a variable for input column</font><br clear="all">
  <font color="MidnightBlue">iMaxCorrectNum = ttk.Entry(MainWindowRightFrame, textvariable=MaxCorrectNumVar, width=ColumnWidth).grid(row=1, column=0) &nbsp;#Create input column and link it with the variable</font><br clear="all">
  <br clear="all">
  <font color="Blue">mMaxTrialNum = ttk.Label(MainWindowRightFrame, text='MaxTrialNum', width=ColumnWidth).grid(row=0, column=1, sticky=W)</font><br clear="all">
  <font color="Blue">MaxTrialNumVar = IntVar(MainWindowRoot) &nbsp;# Declare a variable for input column</font><br clear="all">
  <font color="MidnightBlue">i</font><font color="Blue">MaxTrialNum = ttk.Entry(MainWindowRightFrame, textvariable=MaxTrialNumVar, width=ColumnWidth).grid(row=1, column=1)</font><br clear="all">
  <br clear="all">
  <font color="MidnightBlue">mTimeLimit = ttk.Label(MainWindowRightFrame, text='TimeLimit(min)', width=ColumnWidth).grid(</font><font color="Blue">row=0, column=2</font><font color="MidnightBlue">, sticky=W)</font><br clear="all">
  <font color="MidnightBlue">TimeLimitVar = IntVar(MainWindowRoot)</font><br clear="all">
  <font color="MidnightBlue">iTimeLimit = ttk.Entry(MainWindowRightFrame, textvariable=TimeLimitVar, width=ColumnWidth).grid(</font><font color="Blue">row=1, column=2</font><font color="MidnightBlue">)</font><br clear="all">
  <br clear="all">
  <font color="Blue">mPunishDur = ttk.Label(MainWindowRightFrame, text='PunishDur(s)', width=ColumnWidth).grid(row=0, column=3, sticky=W)</font><br clear="all">
  <font color="Blue">PunishDurVar = IntVar(MainWindowRoot)</font><br clear="all">
  <font color="MidnightBlue">i</font><font color="Blue">PunishDur = ttk.Entry(MainWindowRightFrame, textvariable=PunishDurVar, width=ColumnWidth).grid(row=1, column=3)</font><br clear="all">
  <br clear="all">
  <font color="MidnightBlue">mLickDur = ttk.Label(MainWindowRightFrame, text='LickDur(s)', width=ColumnWidth).grid(</font><font color="Blue">row=0, column=4</font><font color="MidnightBlue">, sticky=W)</font><br clear="all">
  <font color="MidnightBlue">LickDurVar = IntVar(MainWindowRoot)</font><br clear="all">
  <font color="MidnightBlue">iLickDur = ttk.Entry(MainWindowRightFrame, textvariable=LickDurVar, width=ColumnWidth).grid(</font><font color="Blue">row=1, column=4</font><font color="MidnightBlue">)</font><br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Black">Now those 2 entries are implemented.</font><br clear="all">
  <img src="paste1723.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Black">Add the load process for the new parameters.</font><br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<font color="MidnightBlue">else: &nbsp;# If save file doesn't exist</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;MaxCorrectNumVar.set(80) &nbsp;# Assign 80 into the variable</font><br clear="all">
  <br clear="all">
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;i<font color="Blue">f os.path.exists(Str + '/MaxTrialNum.dat') == True:</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;with open(Str + '/MaxTrialNum.dat', 'rb') as PickleInst[GetTaskID()]:</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;MaxTrialNumVar.set(pickle.load(PickleInst[GetTaskID()]))</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;else:</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;MaxTrialNumVar.set(110)</font><br clear="all">
  <br clear="all">
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <font color="MidnightBlue">if os.path.exists(Str + '/TimeLimit.dat') == True:</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;with open(Str + '/TimeLimit.dat', 'rb') as PickleInst[GetTaskID()]:</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TimeLimitVar.set(pickle.load(PickleInst[GetTaskID()]))</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;else:</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TimeLimitVar.set(600)</font><br clear="all">
  <br clear="all">
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <font color="Blue">if os.path.exists(Str + '/PunishDur.dat') == True:</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;with open(Str + '/PunishDur.dat', 'rb') as PickleInst[GetTaskID()]:</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PunishDurVar.set(pickle.load(PickleInst[GetTaskID()]))</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;else:</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PunishDurVar.set(10)</font><br clear="all">
  <br clear="all">
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <font color="MidnightBlue">if os.path.exists(Str + '/LickDur.dat') == True:</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;with open(Str + '/LickDur.dat', 'rb') as PickleInst[GetTaskID()]:</font><br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Black">This task uses two panels so add a new ROI for the additional panel.</font><br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <font color="MidnightBlue">PutRoiGui(0, 1, 1, 0) &nbsp;# Put setting GUI of the indicated ROI on ROI window (ROI number, Detection mode, Threshold direction, ShowSymbolor not)</font><br clear="all">
  <font color="Blue">PutRoiGui(1, 1, 1, 0)</font><br clear="all">
  <font color="MidnightBlue">PutRoiGui(19, 0, 0, 1)</font><br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <br clear="all">
  <br clear="all">
  Add the save process for the new task parameters.<br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;with open(Str+'/MaxCorrectNum.dat', 'wb') as PickleInst[GetTaskID()]:</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pickle.dump(MaxCorrectNumVar.get(),PickleInst[GetTaskID()]) &nbsp; &nbsp; # Save a value of &quot;MaxCorrectNumVar&quot; as &quot;MaxCorrectNum.dat&quot; file</font><br clear="all">
  <br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;with open(Str+'/MaxTrialNum.dat', 'wb') as PickleInst[GetTaskID()]:</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pickle.dump(MaxTrialNumVar.get(),PickleInst[GetTaskID()]) &nbsp; &nbsp; # Save a value of &quot;MaxCorrectNumVar&quot; as &quot;MaxCorrectNum.dat&quot;file</font><br clear="all">
  <br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;with open(Str+'/TimeLimit.dat', 'wb') as PickleInst[GetTaskID()]:</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pickle.dump(TimeLimitVar.get(),PickleInst[GetTaskID()])</font><br clear="all">
  <br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;with open(Str+'/PunishDur.dat', 'wb') as PickleInst[GetTaskID()]:</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pickle.dump(PunishDurVar.get(), PickleInst[GetTaskID()])</font><br clear="all">
  <br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;with open(Str+'/LickDur.dat', 'wb') as PickleInst[GetTaskID()]:</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pickle.dump(LickDurVar.get(), PickleInst[GetTaskID()])</font><br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <br clear="all">
  <br clear="all">
  Change the message to show “Test2 task (91)”<br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp;if Phase == 1: &nbsp;# Waiting phase (Task will start when the set time arrives)</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if Phase1_Init == 0: # If the initialization for phase1 has not done</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PutPreTaskButton() &nbsp;# Put &quot;StartNow&quot; and &quot;Back&quot; button on Main window</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mStatusVar = StringVar(MainWindowRoot) &nbsp;# Create a variable for status display</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mStatus = ttk.Label(MainWindowRightFrame, textvariable=mStatusVar) &nbsp;# Create label object and link it with Main window</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mStatus.place(x=10, y=0) &nbsp; &nbsp;# Place label object on the Main window</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mOngoingResultVar = StringVar(MainWindowRoot) &nbsp; # Create a variable for progress display</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Phase1_Init = 1 # Flat that phase1 has done</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mStatusVar.set('</font><font color="Blue">Test2 task</font><font color="MidnightBlue">(' + str(GetTaskID()) + ') &nbsp; &nbsp;Waiting...') &nbsp; &nbsp;# Show current status of the Operant House</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if IsStartTime() == 1: &nbsp;# Check whether task start time arrives</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;StartNow() &nbsp;# Start task (Phase number will be &quot;2&quot;)</font><br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <img src="paste2491.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  Do the same in <font color="Blue">Phase == 2</font>.<br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp;if Phase == 2: &nbsp;# If it is during task</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if Phase2_Init == 0: # Initialization of the task</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PutEndTaskNowButton() &nbsp; # Put &quot;TaskEnd&quot; button on Main window</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mStatusVar.set('</font><font color="Blue">Test2 task</font><font color="MidnightBlue">(' + str(GetTaskID()) + ') &nbsp; &nbsp;Start time ' + str(TaskStartedMonth) + '/' + str(TaskStartedDay) + ' ' + str(TaskStartedHour) + ':' + str(TaskStartedMinute) + ' &nbsp; &nbsp;Running') &nbsp; &nbsp;# Assign latest information about current task into &quot;mStatusVar&quot;</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mOngoingResult = ttk.Label(MainWindowRightFrame, textvariable=mOngoingResultVar)</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mOngoingResult.place(x=10, y=18)</font><br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Black">Add new variables for the new task parameters.</font><br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Assign task parameter values in StringVars into integer or string variable (to make the cord easeir to read)</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;MaxCorrectNum = int(MaxCorrectNumVar.get()) &nbsp; # Get the value of &quot;MaxCorrectNumVar&quot; and convert it from string to integerand assign into variable named &quot;MaxCorrectNum&quot;</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;MaxTrialNum = int(MaxTrialNumVar.get())</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TimeLimit = int(TimeLimitVar.get())</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PunishDur = int(PunishDurVar.get())</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LickDur = int(LickDurVar.get())</font><br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Black">This task needs additional variables which hold total/incorrect trial numbers and an ID of the current correct panel.</font><br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Declar local variables for this task</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TrialNum = 0 &nbsp; &nbsp;# Current trial number</font><br clear="all">
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<font color="MidnightBlue">CorrectNum = 0 &nbsp;# Current correct trial number</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;IncorrectNum = 0 &nbsp; &nbsp;# Current incorrect trial number</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CorrectRate = 0.0 &nbsp; # Current correct rate</font><br clear="all">
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<font color="MidnightBlue">TaskDur = 0 &nbsp;# This will keep the elapsed time during of task</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NowDrinking = 0 # Use as trigger</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CorrectPanelID = 0 &nbsp;# ID number of current correct panel (0 or 1)</font><br clear="all">
  <br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;StartRecording() &nbsp;# Start camera capture / TTL signal output</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;StartLickRecording() &nbsp;# Start an entry of lick log</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LightCycleControlOff() &nbsp;# Deactivate automatic Light/Dark cycle illumination</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;RoofLightOff() &nbsp;# Turn off the lights on roof (Digital output Ch13)</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;InfraredLightOn() &nbsp; # Turn on the infrared LED illumination (Digital output Ch12)</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DigitalOutOn(10) &nbsp; &nbsp; &nbsp; &nbsp;# Turn on cue LED connected to Ch10</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ServoPosInside(3) &nbsp; # Change the angle of water arm servo connected to Ch3 to inside position</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CreateNormalPanel(0) &nbsp;# Create a white-filled square panel as panel #0</font><br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Black">Add a command to generate the additional panel.</font><br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CreateNormalPanel(1)</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventTxt = open(Path + &quot;/&quot; + str(TimeNow.year) + &quot;_&quot; + str(TimeNow.month) + &quot;_&quot; + str(TimeNow.day) + &quot; &quot; + str(TimeNow.hour) + &quot;h&quot; + str(TimeNow.minute) + &quot;m Task&quot; + str(GetTaskID()) + &quot; Touch.txt&quot;, 'w') &nbsp;# Initialize the text exporter for a resultfile</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventTxt.write('TrialNum\tResult\t\t\tyyyy/mm/dd\th:m\ts\n') &nbsp;# Write item name on the result file</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventCsv = open(Path + &quot;/&quot; + str(TimeNow.year) + &quot;_&quot; + str(TimeNow.month) + &quot;_&quot; + str(TimeNow.day) + &quot; &quot; + str(TimeNow.hour) + &quot;h&quot; + str(TimeNow.minute) + &quot;m Task&quot; + str(GetTaskID()) + &quot; Touch.csv&quot;, 'w')</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;print(&quot;Task #&quot; + str(GetTaskID()) + &quot; is started at &quot; + str(GetTaskStartedMonth()) + '/' + str(GetTaskStartedDay()) + ' ' + str(GetTaskStartedHour()) + ':' + str(GetTaskStartedMinute()) + ':' + str(GetTaskStartedSecond())) &nbsp;# Enter the start time in the consolewindow of Pycharm</font><br clear="all">
  <br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Timer_Start(5) &nbsp;# Start a timer #5 to measure the duration of the task</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Phase2 = 2 &nbsp;# Start task from the reward phase</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Phase2_Init = 1 # Flag indicating that initialization of Phase2 has done</font><br clear="all">
  <br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if Phase2 == 0: &nbsp; # Initiation of new trial</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TaskDur = Timer_GetSec(5)</font><br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CorrectPanelID = int(random.random()*2) # Determine which panel will be assigned as &quot;correct&quot;</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;print('CorrectPanelID: ' + str(CorrectPanelID))</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ShowPanel(CorrectPanelID) &nbsp; &nbsp;# Display panel #0</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Phase2 = 1</font><br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <font color="MidnightBlue">The correct and incorrect panel is assigned randomly. Here</font><font color="Blue">random.random()</font><font color="MidnightBlue">is used to generate “0” or “1” to determine which panelshould be the correct panel. To generate “0” or “1” with the same probability, use</font><font color="Blue">random.random()</font><font color="MidnightBlue">to generate a random real number (? 0and &lt;1). Then multiply it by 2 and round down by converting to an integer. Show the randomly chosen panel with</font><font color="Blue">ShowPanel().</font><font color="MidnightBlue">Then moveto</font><font color="Blue">Phase2 == 1</font><font color="MidnightBlue">.</font><br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if Phase2 == 1: &nbsp; # Panel presentation</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TouchedPanelID = DetectRoiNosepoke() &nbsp;# Examine which panel is touched (return panel ID. If none of the panels touched,return -1)</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if TouchedPanelID != -1 and TouchedPanelID != 19: # If mouse touches the panel</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TrialNum += 1</font><br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <font color="Black">To count the number of touching (= trial number), increase the TrialNum when DetectRoiNosepoke() returns a value other than -1 and 19(-1 is returned when there is no ROI detecting. 19 is returned when the water slit ROI detects the animal).</font><br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Black">If the ROI for the correct panel is activated, make it to the reward phase state and log the correct response and go to the reward phase(</font><font color="Blue">Phase2 = 2</font><font color="Black">).</font><br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if TouchedPanelID == CorrectPanelID: &nbsp; &nbsp;# If touched panel is assigned as correct</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ServoPosInside(3) &nbsp; &nbsp;# Move the water nozzle into inside position</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DigitalOutOn(10) &nbsp; &nbsp;# Onset cue light</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;HidePanel(0) &nbsp; &nbsp;# Turn off panel #0</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;HidePanel(1) &nbsp; &nbsp;# Turn off panel #1</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NowDrinking = 0</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CorrectNum += 1 &nbsp; &nbsp; # Increase the number of correct response</font><br clear="all">
  <br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventTxt.write(str(TrialNum)+'\tPanelTouched(Correct)\t'+ str(TimeNow.year)+&quot;/&quot;+str(TimeNow.month)+&quot;/&quot;+str(TimeNow.day)+&quot;\t&quot;+str(TimeNow.hour)+&quot;:&quot;+str(TimeNow.minute)+&quot;\t&quot;+str(TimeNow.second)+&quot;.&quot;+str(TimeNow.microsecond//1000)+&quot;\n&quot;) # Write the response on the text file</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventCsv.write(str(TrialNum) + ',1,' + str(TimeNow.year) + &quot;,&quot; + str(TimeNow.month) + &quot;,&quot; + str(TimeNow.day)+ &quot;,&quot; + str(TimeNow.hour) + &quot;,&quot; + str(TimeNow.minute) + &quot;,&quot; + str(TimeNow.second) + &quot;.&quot; + str(TimeNow.microsecond//1000)+&quot;\n&quot;) &nbsp;#Write the response on the csv file</font><br clear="all">
  <br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Phase2 = 2 &nbsp;# Start reward phase</font><br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Black">The next code is for the case of an incorrect response.</font><br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if TouchedPanelID != CorrectPanelID: &nbsp; &nbsp;# If touched panel is assigned as incorrect</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ServoPosOutside(3) &nbsp; &nbsp;# Move the water nozzle into inside position</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;HidePanel(0)</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;HidePanel(1)</font><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font><font color="Blue">RoofLightOn() &nbsp; &nbsp;# Turn on the ceiling illumination</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;IncorrectNum += 1 &nbsp; &nbsp; # Increase the number of correct response</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventTxt.write(str(TrialNum)+'\tPanelTouched(Incorrect)\t'+ str(TimeNow.year)+&quot;/&quot;+str(TimeNow.month)+&quot;/&quot;+str(TimeNow.day)+&quot;\t&quot;+str(TimeNow.hour)+&quot;:&quot;+str(TimeNow.minute)+&quot;\t&quot;+str(TimeNow.second)+&quot;.&quot;+str(TimeNow.microsecond//1000)+&quot;\n&quot;) # Write the response on the text file</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventCsv.write(str(TrialNum) + ',2,' + str(TimeNow.year) + &quot;,&quot; + str(TimeNow.month) + &quot;,&quot; + str(TimeNow.day)+ &quot;,&quot; + str(TimeNow.hour) + &quot;,&quot; + str(TimeNow.minute) + &quot;,&quot; + str(TimeNow.second) + &quot;.&quot; + str(TimeNow.microsecond//1000)+&quot;\n&quot;) &nbsp;#Write the response on the csv file</font><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Timer_Start(0) &nbsp;# Start punishment timer</font><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Phase2 = 3 &nbsp;# Start punish phase</font><br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <font color="Black">For the punishment, the ceiling illumination are turned on. The incorrect number is increased and this event is logged to the result textfile. Start timer #0 with</font><font color="Blue">Timer_Start(0)</font><font color="Black">to apply the punishment for a specified amount of time. Then move to the punishment phase (</font><font color="Blue">Phase2==3</font><font color="Black">).</font><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mOngoingResultVar.set('CorrectNum: ' + str(CorrectNum) + ' &nbsp;IncorrectNum: ' + str(IncorrectNum) + ' &nbsp;TrialNum: ' + str(TrialNum))</font><br clear="all">
  <br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if Timer_GetSec(5) &gt;= TimeLimit * 60: &nbsp; # If time limit of the task comes</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TaskDur = Timer_GetSec(5)</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;print(&quot;Time limit elapsed&quot;)</font><br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <font color="Black">Show the correct, incorrect and total number of the trials as intermediate results in the main window using mOngoingResultVar.set().</font><br clear="all">
  <br clear="all">
  <img src="paste511.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if Phase2 == 2: &nbsp;# Reward phase</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if DetectRoiNosepoke() == 19 and NowDrinking == 0: &nbsp; &nbsp;# If the mouse initiates nose poking</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NowDrinking = 1</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Timer_Start(0) &nbsp;# Start lick timer</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if NowDrinking == 1: &nbsp; &nbsp;# If the nose poke has begun</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if Timer_GetSec(0) &gt;= LickDur: &nbsp; # If the nosepoke duration exceeds the lick duration</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Timer_End(0) # End timer for measuring lick duration</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ServoPosMiddle(3) &nbsp; # Move water nozzle back to the middle position</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DigitalOutOff(10) &nbsp; # Turn off the cue LED</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NowDrinking = 0</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font><font color="Blue">Phase2 = 4 &nbsp;# Go to After trial phase</font><br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <font color="Black">After the reward or punishment phase, an &quot;after trial phase&quot; is added to determine whether to continue the session or not, so add a line togo to the after trial phase (</font><font color="Blue">Phase2 == 4</font><font color="Black">) in the last of reward phase process.</font><br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if Phase2 == 3: &nbsp;# Punishment phase</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if Timer_GetSec(0) &gt;= PunishDur: &nbsp;# If punishment time is passed</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Timer_End(0) &nbsp;# End punishment timer1</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;RoofLightOff()</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ServoPosMiddle(3) &nbsp;# Move water nozzle to the intermediate position</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Phase2 = 4 &nbsp;# Go to After trial phase</font><br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <font color="Black">Add a process of the punishment phase that keeps checking the elapse of the punishment time using</font><font color="Blue">Timer_GetSec(0)</font><font color="Black">and moves to the &quot;after trial phase&quot; when the time has elapsed.</font><br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <font color="MidnightBlue">&nbsp;</font><font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if Phase2 == 4: &nbsp;# After trial phase</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if CorrectNum &lt; MaxCorrectNum and TrialNum &lt; MaxTrialNum: &nbsp;# If the touch number doesn't exceed the maximum number</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Phase2 = 0</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if CorrectNum &gt;= MaxCorrectNum or TrialNum &gt;= MaxTrialNum: &nbsp;# If the touch number exceeds the maximum number</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TaskDur = Timer_GetSec(5) &nbsp;# Keep the task time</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Phase2 = -1 &nbsp;# Go to the task finalizing phase</font><br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <font color="Black">Add the &quot;after trial phase&quot; after the punishment phase.</font>This code checks whether the correct trials or total trials have reached the limits. If those limits have not been reached, it goes back to the initialization of the next trial. If the limit has reached, assigns the task lapsed time to the <font color="Blue">TaskDur</font> and goes to the task end phase (<font color="Blue">Phase2 = -1</font>).<br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<font color="MidnightBlue">if Phase2 == -1 or GetEndTaskNowButtonStat() == 1: &nbsp;# If the flag is set to finish the task</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LightCycleControlOn() &nbsp; # Activate automatic light/dark cycle</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ServoPosMiddle(3) &nbsp; # Moze servo nozzle into middle position</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DeleteAllPanel() &nbsp; &nbsp;# Remove a panel on touch screen</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;InfraredLightOff() &nbsp;# Turn off the infrared LED</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if GetRecordingStat() == 1: # If camera is capturing</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SetEndRecordingTimer(60) &nbsp; &nbsp;# Onset a timer to finish video recording after 60 frames (correspond about 2sec) from now</font><br clear="all">
  <br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Add summary of results into the result file</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font><font color="Blue">if CorrectNum &gt; 0 or IncorrectNum &gt; 0:</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CorrectRate = int(CorrectNum * 100.0 / TrialNum)</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventTxt.write('TotalNum:' + str(TrialNum) + ' &nbsp;CorrectNum:' + str(CorrectNum) + ' &nbsp;IncorrectNum:' + str(IncorrectNum) + ' &nbsp;CorrectRate:' + str(CorrectRate) + '%\n')</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventTxt.write('SessionStartTime: ' + str(GetTaskStartedMonth()) + '/' + str(GetTaskStartedDay()) + ' ' + str(GetTaskStartedHour()) + ':' + str(GetTaskStartedMinute()) + ':' + str(GetTaskStartedSecond()) + &quot;\n&quot;)</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventTxt.write('SessionEndTime: ' + str(TimeNow.month) + '/' + str(TimeNow.day) + ' ' + str(TimeNow.hour) + ':' +str(TimeNow.minute) + ':' + str(TimeNow.second + (TimeNow.microsecond // 1000) / 1000) + &quot;\n&quot;)</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventTxt.write('TaskDuration(sec): ' + str(TaskDur) + &quot;\n&quot;)</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Add experimental conditions into the result file</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventTxt.write('MaxCorrectNum: '+str(MaxCorrectNum)+&quot;\n&quot;)</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventTxt.write('MaxTrialNum: ' + str(MaxTrialNum) + &quot;\n&quot;)</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventTxt.write('TimeLimit: ' + str(TimeLimit) + &quot;\n&quot;)</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventTxt.write('PunishDur: ' + str(TimeLimit) + &quot;\n&quot;)</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventTxt.write('LickDur: ' + str(LickDur)+&quot;\n&quot;)</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventTxt.write('RecordFPS: ' + str(GetRecordFps()) + &quot;\n&quot;) &nbsp;# Recorded frame number per second</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventTxt.write(GetRoiSensitivity() + &quot;\n&quot;) &nbsp;# Settings of each ROI</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventTxt.write(GetServoAngle() + &quot;\n&quot;) &nbsp;# Set angles of each servo</font><br clear="all">
  <br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventTxt.close() &nbsp; &nbsp;# Close the text exporter for the result file</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Writer_TouchEventCsv.close()</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;EndLickRecording() &nbsp;# End lick log recording</font><br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <font color="Black">Modify the session termination process. Because there is a right and wrong response, add</font><font color="Blue">IncorrectNum</font><font color="Black">and</font><font color="Blue">TrialNum.</font><font color="Black">Also calculate thecorrect rate and record it to the result text. Add lines to record new task parameters (</font><font color="Blue">MaxTrialNum</font><font color="Black">and</font><font color="Blue">PunishDur</font><font color="Black">).</font><br clear="all">
  <br clear="all">
  <img src="paste1724.jpg" alt="" border="0"><br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <font color="Blue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font><font color="Navy">SendMail(DeviceNameVar.get()+' finished task '+str(GetTaskID())+</font><font color="Blue">'. TrialNum:'+str(TrialNum)+</font><font color="Navy">' Correct:'+str(CorrectNum)+</font><font color="Blue">'Incorrect:'+str(IncorrectNum)+' Rate:'+str(CorrectRate)</font><font color="Navy">+'% Dur:'+str(round(Timer_GetSec(5) / 60,1))+' min','The task is finished.') # Send aemail (correct number and task duration are added to email title)</font><br clear="all">
  <br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Phase = 1 &nbsp;# Go back to the task-waiting phase</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Phase2 = 0</font><br clear="all">
  <font color="MidnightBlue">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Phase2_Init = 0</font><br clear="all">
  <font color="Navy">=================================================================================================</font><br clear="all">
  <font color="Black">Finally include the new result parameters to the title of the email.</font><br clear="all">
  <br clear="all">
  <br clear="all">
  <font color="Black">Task 91 is now complete. Please try it to see if it runs properly.</font><br clear="all">
  <font color="Black">If you would like to see how Task 90 and 91 have changed, you can open Task 90 and 91 in the &quot;Tutorial&quot; folder in the OperantHouseprogram with WinMerge, which highlights differences between two source codes.</font></div>
  </div>
  <div id="footer">operanthouseのフッター</div>
  <div id="HPZLPPageTail" style="clear: both;"></div></div>
</body>

</html>
